EvalLocalization ver1.0
2014/10/26 takuya minagawa

1. 概要
このプログラムは物体検出の結果を定量的に評価するためのプログラムです。
評価方法はPascal VOC 2009に従っています。

Everingham, M., Gool, L., Williams, C. K. I., Winn, J., & Zisserman, A. (2009). The Pascal Visual Object Classes (VOC) Challenge. International Journal of Computer Vision, 88(2).


2. インストール
ビルドには、boostとOpenCVが必要です。
boost
http://www.boost.org/

OpenCV
http://opencv.org/

コンパイル済みのバージョンを使用する場合は、EvalLocalization.zipを解凍してexeファイルを実行するだけです。
もし実行ファイルがうまく動かない場合は、VC++2013のランタイムをインストールする必要があるかもしれません。
以下のサイトからお使いのプロセッサにあったランタイムを探し、ダウンロードとインストールをして下さい

http://www.microsoft.com/ja-jp/download/details.aspx?id=40784


3. 使い方
本プログラムの使い方は以下の通りです。

EvalLocalization <localization file> <ground truth file> <output file> [option]

<localization file>
検出結果を記述したファイルです。
以下のフォーマットに従います。
=================================
「画像ファイル名」 「検出数」 「左上x座標」 「左上y座標」 「幅」 「高さ」...
  .
  .
  .
=================================

例えば(x,y,w,h)=(10,14,100,120), (141,151,100,120)オブジェクトが２つあるケースの場合

=====================================
20100915-1/0000004.jpg 2 10 14 100 120 141 151 100 120
=====================================
というフォーマットになります。


<ground truth file>
正解ラベルファイルです。
<localization file>と同じフォーマットです。


<output file>
出力ファイルです。以下のようなフォーマットのCSVファイルです。
====================================
「画像ファイル名」,「正解検出数」,「誤検出数」,「未検出数」
  .
  .
  .
===================================


[option]
指定できるオプションは以下の通りです。
-h	ヘルプの表示
-s <file path>	スコアファイルの指定
-c <threshold>	スコアの閾値設定（デフォルト:0.5）
-o <threshold>	オーバーラップの閾値を設定（デフォルト:0.5）
-d <directory path>	検出結果を描画した画像を保存するフォルダ名
-t <file path>	正しく検出された結果のみ出力するテキストファイル名
-f <file path>	誤検出結果のみ出力するテキストファイル名
-r <file path>	recall-precision curveをCSV形式で出力


例えば、以下のような形でコマンドを使用します。
============================================
EvalLocalization.exe testResult.txt trueLocations.txt summary.csv -s testProb.txt -d ./Draw -t true_positive.txt -f false_positive.txt -r RP.csv -c 0.7 -o 0.5
============================================


4. スコアファイル
'-s'オプションで各検出結果に紐づいたスコアを指定することができます。
以下のようなフォーマットです。
========================================
「検出数」　「スコア」　「スコア」　...
========================================

上記のように「スコア」を検出数の数だけ並べます。
例:
=============================================
2 0.864495 0.860051
2 0.913481 0.861791
1 0.901213
2 0.854541 0.755583
.
.
.
=============================================

このファイルの各行が<localization file>の各行に対応します。
また、<localization file>の各検出結果に上記の「スコア」が対応します。
したがって「検出数」は上記のスコアファイルと<localization file>で一致している必要があります。


5. 閾値の指定
ここでは２つの閾値を指定することができます。
一つは上記のスコアに対応する閾値で'-c'オプションで指定します。
もう一つはground truthと検出結果の矩形同士の重なりの閾値で'-o'オプションで指定します。
どちらもデフォルトは0.5です。
特に矩形の重なりの閾値はPascal VOCでは0.5と定められています。


6. 正解/非正解の出力
'-d'オプションで指定したフォルダ内に結果画像を保存します。
結果画像は、<localization file>の1列目に記述したファイルパスを読み取り、正しく検出された位置を青の矩形、誤って検出された位置を赤の矩形で描画します。
ファイル名は

1.png
2.png
.
.
.
といった形でPNG形式で保存されます。
ここで各ファイル名の番号は<localization file>の行に対応します。

また、'-t'および'-f'オプションで、これらの情報をテキストファイルへ出力することができます。
つまり'-t'で正解検出情報を'-f'で誤検出情報をそれぞれ<localization file>と同形式で出力します。


正しい検出か誤検出かの判断は'-c'と'-o'オプションで指定した２つの閾値を元に行います。



7. Recall-Precision Curve
'-r'オプションを指定することで、Recall Precision CurveをCSV形式で出力することができます。
ただし、このオプションを指定するには'-s'でスコアファイルを指定している必要があります。
出力フォーマットは以下の通りです。
===============================
「閾値」，「Recall」，「Precision」
===============================
RecallとPrecisionで散布図を作成すればRPカーブを可視化できます。

また標準出力からaverage precisionを出力します。


8. ライセンス
本ソフトウェアは"MIT License"で公開します。
MITライセンスについては、こちらのURL参照。

http://opensource.org/licenses/MIT

ただし、本ライブラリの開発に用いているOpenCVおよびBoostに関しては、それぞれのライブラリのライセンスに準じます。


皆川卓也(z.takmin@gmail.com)
